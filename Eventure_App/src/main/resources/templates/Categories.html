<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Categories</title>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <nav class="bg-white shadow p-4">
      <div class="container mx-auto flex justify-between">
        <span class="font-bold text-xl text-blue-500">EVENTURE</span>
        <a href="/logout" class="text-red-500 hover:text-red-600">Logout</a>
      </div>
    </nav>

    <div class="container mx-auto mt-12">
      <h1 class="text-4xl font-bold text-center">Categories</h1>
      <div class="mt-8 text-center">
        <button
          id="addCategoryButton"
          class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          th:onclick="|document.getElementById('addCategoryForm').classList.remove('hidden')|"
        >
          Add Category
        </button>

        <!-- Add Category Form -->
        <div
          id="addCategoryForm"
          class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"
        >
          <div class="bg-white p-6 border rounded-lg shadow-lg w-1/3">
            <form
              th:action="@{/categories}"
              th:object="${category}"
              method="post"
              id="categoryForm"
            >
              <input type="hidden" th:field="*{id}" />
              <div class="mb-4">
                <label for="title" class="block text-gray-700">Title</label>
                <input
                  type="text"
                  id="title"
                  th:field="*{title}"
                  class="w-full border rounded p-2"
                  required
                />
              </div>
              <div class="flex justify-end">
                <button
                  type="button"
                  class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 mr-2"
                  th:onclick="|document.getElementById('addCategoryForm').classList.add('hidden')|"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  id="formSubmitButton"
                  class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                >
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Category Table -->
        <table class="min-w-full bg-white mt-4">
          <thead>
            <tr>
              <th class="py-2">Title</th>
              <th class="py-2">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="category : ${categories}">
              <td class="border px-4 py-2" th:text="${category.title}"></td>
              <td class="border px-4 py-2">
                <!-- Edit Action -->
                <a
                  href="#"
                  class="text-blue-500 hover:text-blue-700"
                  th:attr="onclick=|document.getElementById('editCategoryForm').classList.remove('hidden'); document.getElementById('editCategoryId').value='[[${category.id}]]'; document.getElementById('editTitle').value='[[${category.title}]]'; return false;|"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 inline"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828zM4 12v4h4v-1H5v-3H4z"
                    />
                  </svg>
                  Edit
                  <!-- Edit Category Modal -->
                  <div
                    id="editCategoryForm"
                    class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"
                  >
                    <div class="bg-white p-6 border rounded-lg shadow-lg w-1/3">
                      <form th:action="@{/categories/update}" th:object="${category}" method="post">
                        <input type="hidden" th:field="*{id}" id="editCategoryId" name="id" />
                        <div class="mb-4">
                          <label for="editTitle" class="block text-gray-700">Title</label>
                          <input
                            type="text"
                            th:field="*{title}"
                            id="editTitle"
                            name="title"
                            class="w-full border rounded p-2"
                            required
                          />
                        </div>
                        <div class="flex justify-end">
                          <button
                            type="button"
                            class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 mr-2"
                            th:onclick="|document.getElementById('editCategoryForm').classList.add('hidden')|"
                          >
                            Cancel
                          </button>
                          <button
                            type="submit"
                            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                          >
                            Update
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </a>
                <!-- Delete Action -->
                <form
                  th:action="@{/categories/delete}"
                  method="post"
                  class="inline-block"
                  onsubmit="return confirm('Are you sure you want to delete this category?');"
                >
                  <input type="hidden" name="id" th:value="${category.id}" />
                  <button
                    type="submit"
                    class="text-red-500 hover:text-red-700 ml-4 border-none bg-transparent cursor-pointer"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5 inline"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M6 2a1 1 0 00-1 1v1H3a1 1 0 100 2h14a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 4a1 1 0 011 1v8a1 1 0 11-2 0V7a1 1 0 011-1zm4 0a1 1 0 011 1v8a1 1 0 11-2 0V7a1 1 0 011-1z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    Delete
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
